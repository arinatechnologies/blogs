---
title: 'How to Export AWS CloudWatch Logs to OpenSearch (Elasticsearch): Step-by-Step  Tutorial'
date: '2024-09-30'
image: 'https://raw.githubusercontent.com/arinatechnologies/blogs/f8cb218a053afcdca7c93dcea55c3780ea0cfc53/images/awscloudwatchlogtoopensearch.webp'
tags: ['AWS CloudWatch', 'OpenSearch', 'Elasticsearch', 'Log Management', 'AWS Lambda','Cloud Management','CloudWatch Logs Export','AWS IAM Roles','Cloudflare Domain Management','Cloud Monitoring','Cloud Logging Solutions','AWS Cloud Infrastructure','DevOps Tools']
---
# How to Export AWS CloudWatch Logs to OpenSearch (Elasticsearch)

When managing large volumes of AWS CloudWatch logs, the built-in tools may fall short in terms of searchability and cost-effectiveness. A more efficient approach is to export these logs to OpenSearch (formerly Elasticsearch), which offers better performance for log management and analysis. This blog will walk you through the entire process.

<Video id="-OQsVT9GwqI" title="How to Export AWS CloudWatch Logs to OpenSearch(Elasticsearch) Integration:A Complete Guide "/>

## Step 1: Create an OpenSearch Cluster
![OpenSearch Cluster](https://raw.githubusercontent.com/arinatechnologies/blogs/2edfee2f12f4b94d534c9dd5aeed99463eb7b12e/images/cloudwatchlog-opensearch/opensearch%20create.webp)
1. **Go to AWS Console**: Navigate to the OpenSearch Service.
2. **Create a Domain**:
   - Click on “Create Domain.”
   - Choose “Standard Create” instead of “Easy Create” to avoid unnecessary nodes.
3. **Select Domain Configuration**:
   - For a demo, select “Dev/Test.”
   - Choose a general-purpose instance type like the M5 family for performance.
   - Choose the storage settings: `gp3` and size (e.g., 10 GB).
   - Select “Public Access” temporarily for easier setup (but always use VPC access in production).
4. **Set Security Settings**:
   - Set up an IAM master user for OpenSearch.
   - Assign a tag to the domain to make it easier to track.
5. **Create the Domain**: Wait for the domain to become active (this can take up to 30 minutes).

## Step 2: Configure CloudWatch Log Group
![subscription filter](https://raw.githubusercontent.com/arinatechnologies/blogs/2edfee2f12f4b94d534c9dd5aeed99463eb7b12e/images/cloudwatchlog-opensearch/subscption%20filter.webp)
1. **Go to CloudWatch Logs**:
   - Select the log group you want to export.
2. **Create a Subscription Filter**:
   - Choose “OpenSearch” as the destination.
   - Link the subscription filter to your OpenSearch domain created earlier.

## Step 3: Create a Lambda Role
1. **Go to IAM Console**:
   - Create a role for Lambda.
   - Choose the AWS Lambda service.
2. **Attach VPC and OpenSearch Permissions**:
   - Add the necessary policies for Lambda to access VPC and OpenSearch.
3. **Add Inline Policy**:
   - Create an inline policy allowing OpenSearch access (index permissions, bulk data access, etc.).
4. **Save the Role**: Ensure the role is configured properly with access to both OpenSearch and CloudWatch logs.

## Step 4: Create a Lambda Function
![Lambda Function](https://raw.githubusercontent.com/arinatechnologies/blogs/2edfee2f12f4b94d534c9dd5aeed99463eb7b12e/images/cloudwatchlog-opensearch/lamba%20role%20created.webp)
1. **Set Up Lambda**:
   - Create a new Lambda function.
   - Use a runtime like Python or Node.js, depending on your preference.
2. **Edit the Lambda Code**:
   - Update the code to handle exporting CloudWatch logs to specific OpenSearch indices. Modify the default index name and ensure it handles the log data properly.
3. **Deploy the Function**: Once the code is set up, deploy it and link it to your log group subscription.

## Step 5: Debugging and Monitoring

1. **Monitor Logs**:
   - In the CloudWatch Logs section, monitor the log groups for any issues.
   - Open the OpenSearch dashboard and check if the logs are properly flowing into the indices.
2. **Handle Common Errors**:
   - If no logs appear, check the Lambda function for errors.
   - Enable “Debug” mode in the function for better error visibility.
   - Ensure that the Lambda role has the correct permissions and that the OpenSearch cluster is properly configured.

## Step 6: Managing Multiple Log Groups
![Managing Users and Permissions](https://raw.githubusercontent.com/arinatechnologies/blogs/2edfee2f12f4b94d534c9dd5aeed99463eb7b12e/images/cloudwatchlog-opensearch/permission.webp)
1. **Modify Lambda for Multiple Log Groups**:
   - If you have multiple log groups, modify the Lambda function code to create separate indices for each log group.
   - Update the code to check the log group name and route it to a specific index in OpenSearch.
2. **Deploy the Updates**: Ensure the Lambda function properly handles log exports from multiple log groups.

## Step 7: Set Up OpenSearch Users and Roles

1. **Create OpenSearch Users**:
   - In the OpenSearch dashboard, navigate to the security section.
   - Create a user for accessing logs.
2. **Assign Roles**:
   - Create roles with index-level permissions (e.g., read-only, bulk, and monitoring).
   - Map the roles to the created users.
3. **Test User Access**:
   - Log in as the user and ensure they can only access their assigned indices.

## Step 8: Test and Monitor

1. **Run Test Queries**:
   - Use OpenSearch Dev Tools to run queries against the imported log data.
   - Verify that the logs are properly indexed and searchable.
2. **Monitor Cluster Health**:
   - Check the OpenSearch cluster status and ensure it remains healthy.
   - Add more nodes if necessary, especially in production environments, to ensure high availability and better performance.

## Conclusion

Exporting CloudWatch logs to OpenSearch offers improved search capabilities and better scalability. By following these steps, you can set up an efficient logging infrastructure that allows you to analyze large volumes of log data with ease.

--- 
 [ Refer Cloud Consulting](https://www.arinatechnologies.com/consulting) <br/>
Ready to take your cloud infrastructure to the next level? Please reach out to us [ Contact Us](https://www.arinatechnologies.com/contact) <br/>
# Other Blogs
[Step-by-Step Guide: Install and Configure GitLab on AWS EC2 | DevOps CI/CD with GitLab on AWS](https://www.arinatechnologies.com/posts/gitLabonaws) <br/>
[Simplifying AWS Notifications: A Guide to User Notifications](https://www.arinatechnologies.com/posts/user-notifications) <br/>
